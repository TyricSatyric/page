<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Encoder</title>
</head>

<body>
    <div id="hide">
        <h1>Hide Message</h1>
        <p>Secret message</p>
            <input type="text" autocomplete="off" id="secret"/>
        <p>Cover text</p>
            <input type="text" autocomplete="off" id="cover"/>
        <p>Result</p>
            <textarea readonly id="result"></textarea>
        <p></p>
        <input type="button" value="Generate and Copy" onclick="hideMessage()"/>
        <p id="hide_status"></p>
    </div>
    <div id="reveal">
        <h1>Reveal Message</h1>
        <p>Text with hidden message</p>
            <input type="text" autocomplete="off" id="encoded"/>
        <p>Result</p>
            <textarea readonly id="reveal_result"></textarea>
        <p></p>
        <input type="button" value="Reveal Message" onclick="revealMessage()"/>
    </div>
</body>
<style>
    #hide
    {
        padding-left: 20%;
        float: left;
    }
    #reveal
    {
        padding-right: 20%;
        float: right;
    }
    body {
        text-align: center;
        font-family: Arial, sans-serif;
        margin: 20px;
    }
    h1 {
        color: #333;
    }
    p {
        margin: 10px 0 5px;
    }
    input[type="text"] {
        width: 300px;
        padding: 5px;
        margin-bottom: 15px;
    }
    input[type="button"] {
        padding: 10px 15px;
        background-color: white;
        color: black;
        cursor: pointer;
    }
    #result {
        resize: none;
        width: 300px;
        vertical-align: top;
        text-align: start;
        height: 100px;
        color: black;
    }
    #reveal_result {
        resize: none;
        width: 300px;
        vertical-align: top;
        text-align: start;
        height: 100px;
        color: black;
    }
</style>
<script>
    // --- Zero-Width Characters ---
    // We use these to encode the binary data invisible to the eye
    var ZW_ZERO = '\u200b';  // Zero Width Space (Binary 0)
    var ZW_ONE = '\u200c';   // Zero Width Non-Joiner (Binary 1)
    var ZW_JOINER = '\u200d'; // Zero Width Joiner (Start/End Marker)
    var hide_status = document.getElementById("hide_status");
    var result = document.getElementById("result");
    var result_reveal = document.getElementById("reveal_result");

    function revealMessage() {
        let encodedText = document.getElementById("encoded").value
        if (!encodedText.includes(ZW_JOINER)) {
            result_reveal.value = "No hidden message found.";
            return;
        }
        let recording = false;
        let binaryMessage = "";
        for (let i = 0; i < encodedText.length; i++) {
            if (encodedText[i] === ZW_JOINER) {
                recording = !recording;
            }
            else if (recording) {
                if (encodedText[i] === ZW_ZERO) {
                    binaryMessage += "0";
                } else if (encodedText[i] === ZW_ONE) {
                    binaryMessage += "1";
                }
            }
        }
        let message = "";
        for (let j = 0; j < binaryMessage.length; j += 8) {
            let byte = binaryMessage.substr(j, 8);
            message += String.fromCharCode(parseInt(byte, 2));
        }
        result_reveal.value = message;
    }

    function hideMessage(){
        let secret = document.getElementById("secret").value;
        let cover = document.getElementById("cover").value;
        if (secret === "") {
            hide_status.textContent = "No secret text provided.";
            return;
        }
        let binaryMessage = secret.split('').map(char => {
            return char.charCodeAt(0).toString(2).padStart(8, '0');
        }).join('');
        let hiddenLoad = "";
        for (let bit of binaryMessage) {
            hiddenLoad += (bit === '0') ? ZW_ZERO : ZW_ONE;
        }
        let fullHidden = ZW_JOINER + hiddenLoad + ZW_JOINER;
        let finalText = "";
        if(cover.length > 0) {
            finalText = cover.substring(0, 1) + fullHidden + cover.substring(1);
        } else {
            finalText = fullHidden;
        }
        result.value = finalText;
        navigator.clipboard.writeText(finalText).then(function() {
            hide_status.textContent = "Hidden message generated and copied to clipboard.";
        }, function(err) {
            hide_status.textContent = "Could not copy text: " + err;
        });
    }
</script>
</html>